<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MySQL之SQL语句分析及优化 | sjc的搬砖小屋</title><meta name="keywords" content="MySQL,索引,优化"><meta name="author" content="icbtbo"><meta name="copyright" content="icbtbo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="介绍了使用explain和show profiles进行语句分析的方式，以及使用慢查询日志进行辅助分析；介绍了索引失效的场景，索引使用的方式； 介绍了一些优化查询的方式。">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL之SQL语句分析及优化">
<meta property="og:url" content="https://icbtbo.github.io/2021/07/03/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL%E4%B9%8BSQL%E8%AF%AD%E5%8F%A5%E5%88%86%E6%9E%90%E5%8F%8A%E4%BC%98%E5%8C%96/index.html">
<meta property="og:site_name" content="sjc的搬砖小屋">
<meta property="og:description" content="介绍了使用explain和show profiles进行语句分析的方式，以及使用慢查询日志进行辅助分析；介绍了索引失效的场景，索引使用的方式； 介绍了一些优化查询的方式。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://icbtbo.github.io/img/default_bg.png">
<meta property="article:published_time" content="2021-07-03T07:57:54.000Z">
<meta property="article:modified_time" content="2021-07-03T08:02:28.223Z">
<meta property="article:author" content="icbtbo">
<meta property="article:tag" content="MySQL">
<meta property="article:tag" content="索引">
<meta property="article:tag" content="优化">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://icbtbo.github.io/img/default_bg.png"><link rel="shortcut icon" href="/img/home.png"><link rel="canonical" href="https://icbtbo.github.io/2021/07/03/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL%E4%B9%8BSQL%E8%AF%AD%E5%8F%A5%E5%88%86%E6%9E%90%E5%8F%8A%E4%BC%98%E5%8C%96/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-07-03 16:02:28'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="sjc的搬砖小屋" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/niu.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">103</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">83</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/default_bg.png)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">sjc的搬砖小屋</a></span><span id="menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><h1 class="post-title">MySQL之SQL语句分析及优化</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-07-03T07:57:54.000Z" title="发表于 2021-07-03 15:57:54">2021-07-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-07-03T08:02:28.223Z" title="更新于 2021-07-03 16:02:28">2021-07-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/MySQL%E9%AB%98%E7%BA%A7/">MySQL高级</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>在使用MySQL时，如果发现查询语句耗时，会进行排查及调优，其中常用的一个方法是用explain查看sql执行计划。</p>
</blockquote>
<h1 id="expain命令解析"><a href="#expain命令解析" class="headerlink" title="expain命令解析"></a>expain命令解析</h1><h2 id="explain示例"><a href="#explain示例" class="headerlink" title="explain示例"></a>explain示例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from user ;</span><br><span class="line">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+</span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra |</span><br><span class="line">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+</span><br><span class="line">|  1 | SIMPLE      | user  | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    5 |   100.00 | NULL  |</span><br><span class="line">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+</span><br><span class="line">1 row in set, 1 warning (0.03 sec)</span><br><span class="line">mysql&gt;  explain</span><br><span class="line">    -&gt;  select count(*)</span><br><span class="line">    -&gt;  from table_c</span><br><span class="line">    -&gt;  where l_id &lt;&gt; &#39;&#39;</span><br><span class="line">    -&gt;  and l_id is not null</span><br><span class="line">    -&gt;  and l_id not in (</span><br><span class="line">    -&gt;    select l_id from table_l</span><br><span class="line">    -&gt;  ) ;</span><br><span class="line">+----+--------------------+---------------+------------+----------------+---------------+--------------+---------+------+-------+----------+------------------------------------+</span><br><span class="line">| id | select_type        | table         | partitions | type           | possible_keys | key          | key_len | ref  | rows  | filtered | Extra                              |</span><br><span class="line">+----+--------------------+---------------+------------+----------------+---------------+--------------+---------+------+-------+----------+------------------------------------+</span><br><span class="line">|  1 | PRIMARY            | table_c       | NULL       | range          | idx_l_id      | idx_l_id     | 51      | NULL | 98519 |   100.00 | Using where; Using index           |</span><br><span class="line">|  2 | DEPENDENT SUBQUERY | table_l       | NULL       | index_subquery | idx_l_id      | idx_l_id     | 387     | func |     2 |   100.00 | Using index; Full scan on NULL key |</span><br><span class="line">+----+--------------------+---------------+------------+----------------+---------------+--------------+---------+------+-------+----------+------------------------------------+</span><br><span class="line">2 rows in set, 1 warning (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  explain</span><br><span class="line">    -&gt;  select count(*)</span><br><span class="line">    -&gt;  from table_c</span><br><span class="line">    -&gt;  where l_id not in (</span><br><span class="line">    -&gt;    select l_id from table_l</span><br><span class="line">    -&gt;  ) ;</span><br><span class="line">+----+--------------------+---------------+------------+----------------+---------------+--------------+---------+------+--------+----------+------------------------------------+</span><br><span class="line">| id | select_type        | table         | partitions | type           | possible_keys | key          | key_len | ref  | rows   | filtered | Extra                              |</span><br><span class="line">+----+--------------------+---------------+------------+----------------+---------------+--------------+---------+------+--------+----------+------------------------------------+</span><br><span class="line">|  1 | PRIMARY            | table_c       | NULL       | index          | NULL          | idx_l_id     | 51      | NULL | 197037 |   100.00 | Using where; Using index           |</span><br><span class="line">|  2 | DEPENDENT SUBQUERY | table_l       | NULL       | index_subquery | idx_l_id      | idx_l_id     | 387     | func |      2 |   100.00 | Using index; Full scan on NULL key |</span><br><span class="line">+----+--------------------+---------------+------------+----------------+---------------+--------------+---------+------+--------+----------+------------------------------------+</span><br><span class="line">2 rows in set, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<h2 id="explain参数详解"><a href="#explain参数详解" class="headerlink" title="explain参数详解"></a>explain参数详解</h2><table>
<thead>
<tr>
<th align="left">id</th>
<th align="left">Columns</th>
<th align="left">JSON Name</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">id</td>
<td align="left">select_id</td>
<td align="left">每个select子句的标识id</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">select_type</td>
<td align="left">None</td>
<td align="left">select语句的类型</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">table</td>
<td align="left">table_name</td>
<td align="left">当前表名</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">partitions</td>
<td align="left">partitions</td>
<td align="left">匹配的分区</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">type</td>
<td align="left">access_type</td>
<td align="left">当前表内访问方式 join type</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">possible_keys</td>
<td align="left">possible_keys</td>
<td align="left">可能使用到的索引</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left">key</td>
<td align="left">key</td>
<td align="left">经过优化器评估最终使用的索引</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left">key_len</td>
<td align="left">key_length</td>
<td align="left">使用到的索引长度</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left">ref</td>
<td align="left">ref</td>
<td align="left">引用到的上一个表的列</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left">rows</td>
<td align="left">rows</td>
<td align="left">rows_examined，要得到最终记录索要扫描经过的记录数</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left">filtered</td>
<td align="left">filtered</td>
<td align="left">按表条件过滤行的百分比</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left">Extra</td>
<td align="left">None</td>
<td align="left">额外的信息说明</td>
</tr>
</tbody></table>
<h3 id="id"><a href="#id" class="headerlink" title="id"></a>id</h3><p>SELECT识别符。这是SELECT查询序列号。</p>
<p>值有以下三种情况：</p>
<ul>
<li><code>id</code>相同，执行顺序由上至下。</li>
<li><code>id</code>不同，如果是子查询，id的序号会递增，<strong>id值越大优先级越高，越先被执行。</strong></li>
<li><code>id</code>相同不同，同时存在。<strong>永远是id大的优先级最高，id相等的时候顺序执行。</strong></li>
</ul>
<h3 id="select-type"><a href="#select-type" class="headerlink" title="select_type"></a>select_type</h3><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000018729502">每种类型的例子</a></p>
<p>select类型，它有以下几种:</p>
<table>
<thead>
<tr>
<th align="left">id</th>
<th align="left">select_type value</th>
<th align="left">JSON name</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">SIMPLE</td>
<td align="left">None</td>
<td align="left">简单的SELECT语句（不包括UNION操作或子查询操作）</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">PRIMARY</td>
<td align="left">None</td>
<td align="left">PRIMARY：查询中最外层的SELECT（如两表做UNION或者存在子查询,外层的表操作为PRIMARY，内层的操作为UNION）</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">UNION</td>
<td align="left">None</td>
<td align="left">UNION：UNION操作中，查询中处于内层的SELECT（内层的SELECT语句与外层的SELECT语句没有依赖关系）</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">DEPENDENT UNION</td>
<td align="left">dependent(true)</td>
<td align="left">DEPENDENT UNION：UNION操作中，查询中处于内层的SELECT（内层的SELECT语句与外层的SELECT语句有依赖关系）</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">UNIOIN RESULT</td>
<td align="left">union_result</td>
<td align="left">UNION RESULT：UNION操作的结果，id值通常为NULL</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">SUBQUERY</td>
<td align="left">None</td>
<td align="left">SUBQUERY：子查询中首个SELECT（如果有多个子查询存在）</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left">DEPENDENT SUBQUERY</td>
<td align="left">dependent(true)</td>
<td align="left">DEPENDENT SUBQUERY：子查询中首个SELECT，但依赖于外层的表（如果有多个子查询存在）</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left">DERIVED</td>
<td align="left">None</td>
<td align="left">DERIVED：被驱动的SELECT子查询（子查询位于FROM子句）</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left">MATERIALIZED</td>
<td align="left">materialized_form_subquery</td>
<td align="left">MATERIALIZED：被物化的子查询</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left">UNCACHEABLE SUBQUERY</td>
<td align="left">cacheable(false)</td>
<td align="left">UNCACHEABLE SUBQUERY：对于外层的主表，子查询不可被物化，每次都需要计算（耗时操作）</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left">UNCACHEABLE UNION</td>
<td align="left">cacheable(false)</td>
<td align="left">UNCACHEABLE UNION：UNION操作中，内层的不可被物化的子查询（类似于UNCACHEABLE SUBQUERY）</td>
</tr>
</tbody></table>
<h3 id="table"><a href="#table" class="headerlink" title="table"></a>table</h3><p>当前表名</p>
<h3 id="partitions"><a href="#partitions" class="headerlink" title="partitions"></a>partitions</h3><p>匹配的分区</p>
<h3 id="type"><a href="#type" class="headerlink" title="type"></a>type</h3><p>当前表内访问方式（<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000018729502">每种访问方式的例子</a>）</p>
<p><strong>性能由好到坏排序</strong>（加粗的是比较常见的几种）：</p>
<table>
<thead>
<tr>
<th align="left">id</th>
<th align="left">type value</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>system</strong></td>
<td align="left">表中只有一行</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>const</strong></td>
<td align="left">单表中最多有一个匹配行，primary key 或者 unique index的检索</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>eq_ref</strong></td>
<td align="left">多表连接中被驱动表的连接列上有primary key或者unique index的检索</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>ref</strong></td>
<td align="left">与eq_ref类似，但不是使用primary key或者unique index，而是普通索引。也可以是单表上non-unique索引检索</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">fulltext</td>
<td align="left">使用FULLTEXT索引执行连接</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">ref_or_null</td>
<td align="left">与ref类似，区别在于条件中包含对NULL的查询</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left">index_merge</td>
<td align="left">索引合并优化，利用一个表里的N个索引查询,key_len表示这些索引键的和最长长度。</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left">unique_subquery</td>
<td align="left">in的后面是一个查询primary key\unique字段的子查询</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left">index_subquery</td>
<td align="left">in的后面是一个查询普通index字段的子查询</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><strong>range</strong></td>
<td align="left">单表索引中的范围查询,使用索引查询出单个表中的一些行数据。ref列会变为null</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><strong>index</strong></td>
<td align="left"><code>Full Index Scan</code>，全索引扫描，<code>index</code>和<code>ALL</code>的区别为<code>index</code>类型只遍历索引树。通常比<code>All</code>快，因为索引文件通常比数据文件小。它有两种情况：(1)覆盖索引 (2)用索引的顺序做一个全表扫描。</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><strong>all</strong></td>
<td align="left">全表扫描</td>
</tr>
</tbody></table>
<h3 id="possible-keys"><a href="#possible-keys" class="headerlink" title="possible_keys"></a>possible_keys</h3><p>表示 MySQL 在查询时, 能够使用到的索引. 注意, 即使有些索引在 <code>possible_keys</code> 中出现, 但是并不表示此索引会真正地被 MySQL 使用到. MySQL 在查询时具体使用了哪些索引, 由 <code>key</code> 字段决定.</p>
<h3 id="key"><a href="#key" class="headerlink" title="key"></a>key</h3><p>此字段是 MySQL 在当前查询时所真正使用到的索引.</p>
<h3 id="key-len"><a href="#key-len" class="headerlink" title="key_len"></a>key_len</h3><p>key_len 说明<br>key_len: 4 // INT NOT NULL<br>key_len: 5 // INT DEFAULT NULL<br>key_len: 30 // CHAR(30) NOT NULL<br>key_len: 32 // VARCHAR(30) NOT NULL<br>key_len: 92 // VARCHAR(30) NOT NULL CHARSET=utf8</p>
<p>key_len大小的计算规则:<br>a、一般地，key_len 等于索引列类型字节长度，例如int类型为4-bytes，bigint为8-bytes；<br>b、如果是字符串类型，还需要同时考虑字符集因素，例如：CHAR(30) UTF8则key_len至少是90-bytes；<br>c、若该列类型定义时允许NULL，其key_len还需要再加 1-bytes；<br>d、若该列类型为变长类型，例如 VARCHAR（TEXT\BLOB不允许整列创建索引，如果创建部分索引，也被视为动态列类型），其key_len还需要再加 2-bytes;</p>
<h3 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h3><p>ref列显示使用哪个列或常数与key一起从表中选择行。</p>
<p>常见的有：<code>const</code>，<code>func</code>，<code>null</code>，字段名。</p>
<ul>
<li>当使用常量等值查询，显示<code>const</code>，</li>
<li>当关联查询时，会显示相应关联表的<code>关联字段</code></li>
<li>如果查询条件使用了<code>表达式</code>、<code>函数</code>，或者条件列发生内部隐式转换，可能显示为<code>func</code></li>
<li>其他情况<code>null</code></li>
</ul>
<h3 id="rows"><a href="#rows" class="headerlink" title="rows"></a>rows</h3><p>rows_examined，要得到最终记录索要扫描经过的记录数，这个数越小越好。</p>
<h3 id="filterrd"><a href="#filterrd" class="headerlink" title="filterrd"></a>filterrd</h3><p>按表条件过滤行的百分比</p>
<h3 id="Extra"><a href="#Extra" class="headerlink" title="Extra"></a>Extra</h3><p>Extra是对执行计划的额外说明，包含重要信息。</p>
<p>例如：</p>
<table>
<thead>
<tr>
<th align="left">id</th>
<th align="left">type value</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">const row not found</td>
<td align="left">所要查询的表为空</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">Distinct</td>
<td align="left">mysql正在查询distinct值，因此当它每查到一个distinct值之后就会停止当前组的搜索，去查询下一个值</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">Impossible WHERE</td>
<td align="left">where条件总为false，表里没有满足条件的记录</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">Impossible WHERE noticed after reading const tables</td>
<td align="left">在优化器评估了const表之后，发现where条件均不满足</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">no matching row in const table</td>
<td align="left">当前join的表为const表，不能匹配</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">Not exists</td>
<td align="left">优化器发现内表记录不可能满足where条件</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left">Select tables optimized away</td>
<td align="left">在没有group by子句时，对于MyISAM的select count(*)操作，或者当对于min(),max()的操作可以利用索引优化，优化器发现只会返回一行。</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><strong>Using filesort</strong></td>
<td align="left">使用filesort来进行order by操作</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><strong>Using index</strong></td>
<td align="left">覆盖索引</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left">Using index for group-by</td>
<td align="left">对于group by列或者distinct列，可以利用索引检索出数据，而不需要去表里查数据、分组、排序、去重等等</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left">Using join buffer</td>
<td align="left">之前的表连接在nested loop之后放进join buffer，再来和本表进行join。适用于本表的访问type为range，index或all</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left">Using sort_union,using union,using intersect</td>
<td align="left">index_merge的三种情况</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><strong>Using temporary</strong></td>
<td align="left">使用了临时表来存储中间结果集，适用于group by，distinct，或order by列为不同表的列。</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left">Using where</td>
<td align="left">在存储引擎层检索出记录后，在server利用where条件进行过滤，并返回给客户端</td>
</tr>
</tbody></table>
<h1 id="慢查询日志"><a href="#慢查询日志" class="headerlink" title="慢查询日志"></a>慢查询日志</h1><h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><blockquote>
<p>慢查询日志是什么？</p>
</blockquote>
<ul>
<li>MySQL的慢查询日志是MySQL提供的一种日志记录，它用来记录在MySQL中响应时间超过阈值的语句，具体指运行时间超过<code>long_query_time</code>值的SQL，则会被记录到慢查询日志中。</li>
<li><code>long_query_time</code>的默认值为10，意思是运行10秒以上的语句。</li>
<li>由慢查询日志来查看哪些SQL超出了我们的最大忍耐时间值，比如一条SQL执行超过5秒钟，我们就算慢SQL，希望能收集超过5秒钟的SQL，结合之前<code>explain</code>进行全面分析。</li>
</ul>
<blockquote>
<p>特别说明</p>
</blockquote>
<p><strong>默认情况下，MySQL数据库没有开启慢查询日志，</strong>需要我们手动来设置这个参数。</p>
<p><strong>当然，如果不是调优需要的话，一般不建议启动该参数</strong>，因为开启慢查询日志会或多或少带来一定的性能影响。慢查询日志支持将日志记录写入文件。</p>
<blockquote>
<p>查看慢查询日志是否开以及如何开启</p>
</blockquote>
<ul>
<li>查看慢查询日志是否开启：<code>SHOW VARIABLES LIKE &#39;%slow_query_log%&#39;;</code>。</li>
<li>开启慢查询日志：<code>SET GLOBAL slow_query_log = 1;</code>。<strong>使用该方法开启MySQL的慢查询日志只对当前数据库生效，如果MySQL重启后会失效。</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 1、查看慢查询日志是否开启</span><br><span class="line">mysql&gt; SHOW VARIABLES LIKE &#39;%slow_query_log%&#39;;</span><br><span class="line">+---------------------+--------------------------------------+</span><br><span class="line">| Variable_name       | Value                                |</span><br><span class="line">+---------------------+--------------------------------------+</span><br><span class="line">| slow_query_log      | OFF                                  |</span><br><span class="line">| slow_query_log_file | &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;1dcb5644392c-slow.log |</span><br><span class="line">+---------------------+--------------------------------------+</span><br><span class="line">2 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line"># 2、开启慢查询日志</span><br><span class="line">mysql&gt; SET GLOBAL slow_query_log &#x3D; 1;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>如果要使慢查询日志永久开启，需要修改<code>my.cnf</code>文件，在<code>[mysqld]</code>下增加修改参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line"># 1.这个是开启慢查询。注意ON需要大写</span><br><span class="line">slow_query_log&#x3D;ON  </span><br><span class="line"></span><br><span class="line"># 2.这个是存储慢查询的日志文件。这个文件不存在的话，需要自己创建</span><br><span class="line">slow_query_log_file&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;slow.log</span><br></pre></td></tr></table></figure>

<blockquote>
<p>开启了慢查询日志后，什么样的SQL才会被记录到慢查询日志里面呢？</p>
</blockquote>
<p>这个是由参数<code>long_query_time</code>控制的，默认情况下<code>long_query_time</code>的值为10秒。</p>
<p>MySQL中查看<code>long_query_time</code>的时间：<code>SHOW VARIABLES LIKE &#39;long_query_time%&#39;;</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 查看long_query_time 默认是10秒</span><br><span class="line"># 只有SQL的执行时间&gt;10才会被记录</span><br><span class="line">mysql&gt; SHOW VARIABLES LIKE &#39;long_query_time%&#39;;</span><br><span class="line">+-----------------+-----------+</span><br><span class="line">| Variable_name   | Value     |</span><br><span class="line">+-----------------+-----------+</span><br><span class="line">| long_query_time | 10.000000 |</span><br><span class="line">+-----------------+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>修改<code>long_query_time</code>的时间，需要在<code>my.cnf</code>修改配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"># 这个是设置慢查询的时间，我设置的为1秒</span><br><span class="line">long_query_time&#x3D;1</span><br></pre></td></tr></table></figure>

<p>查新慢查询日志的总记录条数：<code>SHOW GLOBAL STATUS LIKE &#39;%slow_queries%&#39;;</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW GLOBAL STATUS LIKE &#39;%Slow_queries%&#39;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Slow_queries  | 3     |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="日志分析工具"><a href="#日志分析工具" class="headerlink" title="日志分析工具"></a>日志分析工具</h2><p>日志分析工具<code>mysqldumpslow</code>：在生产环境中，如果要手工分析日志，查找、分析SQL，显然是个体力活，MySQL提供了日志分析工具<code>mysqldumpslow</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"># 1、mysqldumpslow --help 来查看mysqldumpslow的帮助信息(mac中先要在环境变量中配置相关路径&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin)</span><br><span class="line">root@1dcb5644392c:&#x2F;usr&#x2F;bin# mysqldumpslow --help</span><br><span class="line">Usage: mysqldumpslow [ OPTS... ] [ LOGS... ]</span><br><span class="line"></span><br><span class="line">Parse and summarize the MySQL slow query log. Options are</span><br><span class="line"></span><br><span class="line">  --verbose    verbose</span><br><span class="line">  --debug      debug</span><br><span class="line">  --help       write this text to standard output</span><br><span class="line"></span><br><span class="line">  -v           verbose</span><br><span class="line">  -d           debug</span><br><span class="line">  -s ORDER     what to sort by (al, at, ar, c, l, r, t), &#39;at&#39; is default  # 按照何种方式排序</span><br><span class="line">                al: average lock time # 平均锁定时间</span><br><span class="line">                ar: average rows sent # 平均返回记录数</span><br><span class="line">                at: average query time # 平均查询时间</span><br><span class="line">                 c: count  # 访问次数</span><br><span class="line">                 l: lock time  # 锁定时间</span><br><span class="line">                 r: rows sent  # 返回记录</span><br><span class="line">                 t: query time  # 查询时间 </span><br><span class="line">  -r           reverse the sort order (largest last instead of first)</span><br><span class="line">  -t NUM       just show the top n queries  # 返回前面多少条记录</span><br><span class="line">  -a           don&#39;t abstract all numbers to N and strings to &#39;S&#39;</span><br><span class="line">  -n NUM       abstract numbers with at least n digits within names</span><br><span class="line">  -g PATTERN   grep: only consider stmts that include this string  </span><br><span class="line">  -h HOSTNAME  hostname of db server for *-slow.log filename (can be wildcard),</span><br><span class="line">               default is &#39;*&#39;, i.e. match all</span><br><span class="line">  -i NAME      name of server instance (if using mysql.server startup script)</span><br><span class="line">  -l           don&#39;t subtract lock time from total time</span><br><span class="line">  </span><br><span class="line"># 2、 案例</span><br><span class="line"># 2.1、得到返回记录集最多的10个SQL</span><br><span class="line">mysqldumpslow -s r -t 10 &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;slow.log</span><br><span class="line"> </span><br><span class="line"># 2.2、得到访问次数最多的10个SQL</span><br><span class="line">mysqldumpslow -s c -t 10 &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;slow.log</span><br><span class="line"> </span><br><span class="line"># 2.3、得到按照时间排序的前10条里面含有左连接的查询语句</span><br><span class="line">mysqldumpslow -s t -t 10 -g &quot;left join&quot; &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;slow.log</span><br><span class="line"></span><br><span class="line"># 2.4、另外建议使用这些命令时结合|和more使用，否则出现爆屏的情况</span><br><span class="line">mysqldumpslow -s r -t 10 &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;slow.log | more</span><br></pre></td></tr></table></figure>

<h1 id="Show-Profile"><a href="#Show-Profile" class="headerlink" title="Show Profile"></a>Show Profile</h1><blockquote>
<p>Show Profile是什么？</p>
</blockquote>
<p><code>Show Profile</code>：MySQL提供可以用来分析当前会话中语句执行的资源消耗情况。可以用于SQL的调优的测量。<strong>默认情况下，参数处于关闭状态，并保存最近15次的运行结果。</strong></p>
<blockquote>
<p>分析步骤</p>
</blockquote>
<p>1、是否支持，看看当前的MySQL版本是否支持。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 查看Show Profile功能是否开启</span><br><span class="line">mysql&gt; SHOW VARIABLES LIKE &#39;profiling&#39;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| profiling     | OFF   |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>2、开启<code>Show Profile</code>功能，默认是关闭的，使用前需要开启。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 开启Show Profile功能</span><br><span class="line">mysql&gt; SET profiling&#x3D;ON;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>3、运行SQL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM &#96;emp&#96; GROUP BY &#96;id&#96;%10 LIMIT 150000;</span><br><span class="line"></span><br><span class="line">SELECT * FROM &#96;emp&#96; GROUP BY &#96;id&#96;%20 ORDER BY 5;</span><br></pre></td></tr></table></figure>

<p>4、查看结果，执行<code>SHOW PROFILES;</code></p>
<p><code>Duration</code>：持续时间。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW PROFILES;</span><br><span class="line">+----------+------------+---------------------------------------------------+</span><br><span class="line">| Query_ID | Duration   | Query                                             |</span><br><span class="line">+----------+------------+---------------------------------------------------+</span><br><span class="line">|        1 | 0.00156100 | SHOW VARIABLES LIKE &#39;profiling&#39;                   |</span><br><span class="line">|        2 | 0.56296725 | SELECT * FROM &#96;emp&#96; GROUP BY &#96;id&#96;%10 LIMIT 150000 |</span><br><span class="line">|        3 | 0.52105825 | SELECT * FROM &#96;emp&#96; GROUP BY &#96;id&#96;%10 LIMIT 150000 |</span><br><span class="line">|        4 | 0.51279775 | SELECT * FROM &#96;emp&#96; GROUP BY &#96;id&#96;%20 ORDER BY 5   |</span><br><span class="line">+----------+------------+---------------------------------------------------+</span><br><span class="line">4 rows in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>5、诊断SQL，<code>SHOW PROFILE cpu,block io FOR QUERY Query_ID;</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># 这里的3是第四步中的Query_ID。</span><br><span class="line"># 可以在SHOW PROFILE中看到一条SQL中完整的生命周期。</span><br><span class="line">mysql&gt; SHOW PROFILE cpu,block io FOR QUERY 3;</span><br><span class="line">+----------------------+----------+----------+------------+--------------+---------------+</span><br><span class="line">| Status               | Duration | CPU_user | CPU_system | Block_ops_in | Block_ops_out |</span><br><span class="line">+----------------------+----------+----------+------------+--------------+---------------+</span><br><span class="line">| starting             | 0.000097 | 0.000090 |   0.000002 |            0 |             0 |</span><br><span class="line">| checking permissions | 0.000010 | 0.000009 |   0.000000 |            0 |             0 |</span><br><span class="line">| Opening tables       | 0.000039 | 0.000058 |   0.000000 |            0 |             0 |</span><br><span class="line">| init                 | 0.000046 | 0.000046 |   0.000000 |            0 |             0 |</span><br><span class="line">| System lock          | 0.000011 | 0.000000 |   0.000000 |            0 |             0 |</span><br><span class="line">| optimizing           | 0.000005 | 0.000000 |   0.000000 |            0 |             0 |</span><br><span class="line">| statistics           | 0.000023 | 0.000037 |   0.000000 |            0 |             0 |</span><br><span class="line">| preparing            | 0.000014 | 0.000000 |   0.000000 |            0 |             0 |</span><br><span class="line">| Creating tmp table   | 0.000041 | 0.000053 |   0.000000 |            0 |             0 |</span><br><span class="line">| Sorting result       | 0.000005 | 0.000000 |   0.000000 |            0 |             0 |</span><br><span class="line">| executing            | 0.000003 | 0.000000 |   0.000000 |            0 |             0 |</span><br><span class="line">| Sending data         | 0.520620 | 0.516267 |   0.000000 |            0 |             0 |</span><br><span class="line">| Creating sort index  | 0.000060 | 0.000051 |   0.000000 |            0 |             0 |</span><br><span class="line">| end                  | 0.000006 | 0.000000 |   0.000000 |            0 |             0 |</span><br><span class="line">| query end            | 0.000011 | 0.000000 |   0.000000 |            0 |             0 |</span><br><span class="line">| removing tmp table   | 0.000006 | 0.000000 |   0.000000 |            0 |             0 |</span><br><span class="line">| query end            | 0.000004 | 0.000000 |   0.000000 |            0 |             0 |</span><br><span class="line">| closing tables       | 0.000009 | 0.000000 |   0.000000 |            0 |             0 |</span><br><span class="line">| freeing items        | 0.000032 | 0.000064 |   0.000000 |            0 |             0 |</span><br><span class="line">| cleaning up          | 0.000019 | 0.000000 |   0.000000 |            0 |             0 |</span><br><span class="line">+----------------------+----------+----------+------------+--------------+---------------+</span><br><span class="line">20 rows in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><code>Show Profile</code>查询参数备注：</p>
<ul>
<li><code>ALL</code>：显示所有的开销信息。</li>
<li><code>BLOCK IO</code>：显示块IO相关开销（通用）。</li>
<li><code>CONTEXT SWITCHES</code>：上下文切换相关开销。</li>
<li><code>CPU</code>：显示CPU相关开销信息（通用）。</li>
<li><code>IPC</code>：显示发送和接收相关开销信息。</li>
<li><code>MEMORY</code>：显示内存相关开销信息。</li>
<li><code>PAGE FAULTS</code>：显示页面错误相关开销信息。</li>
<li><code>SOURCE</code>：显示和Source_function。</li>
<li><code>SWAPS</code>：显示交换次数相关开销的信息。</li>
</ul>
<p>6、<code>Show Profile</code>查询列表，日常开发需要注意的结论：</p>
<ul>
<li><code>converting HEAP to MyISAM</code>：查询结果太大，内存都不够用了，往磁盘上搬了。</li>
<li><code>Creating tmp table</code>：创建临时表（拷贝数据到临时表，用完再删除），非常耗费数据库性能。</li>
<li><code>Copying to tmp table on disk</code>：把内存中的临时表复制到磁盘，危险！！！</li>
<li><code>locked</code>：死锁。</li>
</ul>
<h1 id="索引的创建和删除"><a href="#索引的创建和删除" class="headerlink" title="索引的创建和删除"></a>索引的创建和删除</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* 基本语法 *&#x2F;</span><br><span class="line"></span><br><span class="line">&#x2F;* 1、创建索引 [UNIQUE]可以省略*&#x2F;</span><br><span class="line">&#x2F;* 如果只写一个字段就是单值索引，写多个字段就是复合索引 *&#x2F;</span><br><span class="line">CREATE [UNIQUE] INDEX indexName ON tabName(columnName(length));</span><br><span class="line"></span><br><span class="line">&#x2F;* 2、删除索引 *&#x2F;</span><br><span class="line">DROP INDEX [indexName] ON tabName;</span><br><span class="line"></span><br><span class="line">&#x2F;* 3、查看索引 *&#x2F;</span><br><span class="line">&#x2F;* 加上\G就可以以列的形式查看了 不加\G就是以表的形式查看 *&#x2F;</span><br><span class="line">SHOW INDEX FROM tabName \G;</span><br><span class="line"></span><br><span class="line">&#x2F;*使用ALTER命令来为数据表添加或删除索引*&#x2F;</span><br><span class="line"></span><br><span class="line">&#x2F;* 1、该语句添加一个主键，这意味着索引值必须是唯一的，并且不能为NULL *&#x2F;</span><br><span class="line">ALTER TABLE tabName ADD PRIMARY KEY(column_list);</span><br><span class="line"></span><br><span class="line">&#x2F;* 2、该语句创建索引的键值必须是唯一的(除了NULL之外，NULL可能会出现多次) *&#x2F;</span><br><span class="line">ALTER TABLE tabName ADD UNIQUE indexName(column_list);</span><br><span class="line"></span><br><span class="line">&#x2F;* 3、该语句创建普通索引，索引值可以出现多次 *&#x2F;</span><br><span class="line">ALTER TABLE tabName ADD INDEX indexName(column_list);</span><br><span class="line"></span><br><span class="line">&#x2F;* 4、该语句指定了索引为FULLTEXT，用于全文检索 *&#x2F;</span><br><span class="line">ALTER TABLE tabName ADD FULLTEXT indexName(column_list);</span><br><span class="line"></span><br><span class="line">&#x2F;* 5、该语句删除一个索引，其余删除语句类似 *&#x2F;</span><br><span class="line">ALTER TABLE tabName DROP INDEX indexName(column_list);</span><br></pre></td></tr></table></figure>

<h1 id="索引失效"><a href="#索引失效" class="headerlink" title="索引失效"></a>索引失效</h1><h2 id="示例数据"><a href="#示例数据" class="headerlink" title="示例数据"></a>示例数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show create table user \G</span><br><span class="line">******************************************************</span><br><span class="line">       Table: user</span><br><span class="line">Create Table: CREATE TABLE &#96;user&#96; (</span><br><span class="line">  &#96;id&#96; int(10) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  &#96;name&#96; varchar(20) DEFAULT NULL,</span><br><span class="line">  &#96;age&#96; int(10) DEFAULT &#39;0&#39;,</span><br><span class="line">  &#96;pos&#96; varchar(30) DEFAULT NULL,</span><br><span class="line">  &#96;phone&#96; varchar(11) DEFAULT NULL,</span><br><span class="line">  &#96;created_time&#96; datetime DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;),</span><br><span class="line">  KEY &#96;idx_name_age_pos_phone&#96; (&#96;name&#96;,&#96;age&#96;,&#96;pos&#96;,&#96;phone&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8mb4 COLLATE&#x3D;utf8mb4_0900_ai_ci</span><br></pre></td></tr></table></figure>



<h2 id="违反最左前缀法则"><a href="#违反最左前缀法则" class="headerlink" title="违反最左前缀法则"></a>违反最左前缀法则</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如果索引有多列，要遵守最左前缀法则</span><br><span class="line">即查询从索引的最左前列开始并且不跳过索引中的列</span><br><span class="line">explain select * from user where age &#x3D; 20 and phone &#x3D; &#39;18730658760&#39; and pos &#x3D; &#39;cxy&#39;;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/icbtbo/cloudimg//img/20210702201115.png" alt="索引失效的情况"></p>
<h2 id="在索引列上做任何操作"><a href="#在索引列上做任何操作" class="headerlink" title="在索引列上做任何操作"></a>在索引列上做任何操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如计算、函数、（自动or手动）类型转换等操作，会导致索引失效从而全表扫描</span><br><span class="line">explain select * from user where left(name,5) &#x3D; &#39;zhangsan&#39; and age &#x3D; 20 and phone &#x3D; &#39;18730658760&#39;;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/icbtbo/cloudimg//img/20210702201124.png" alt="索引失效的情况"></p>
<h2 id="索引范围条件右边的列"><a href="#索引范围条件右边的列" class="headerlink" title="索引范围条件右边的列"></a>索引范围条件右边的列</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">索引范围条件右边的索引列会失效（但不包括 不以通配符%开头的立刻语句）</span><br><span class="line">explain select * from user where name &#x3D; &#39;zhangsan&#39; and age &gt; 20 and pos &#x3D; &#39;cxy&#39;;</span><br><span class="line">这条语句like右边索引仍有效</span><br><span class="line">explain select * from user where name like &#39;zhangsan%&#39; and age &gt; 20 ;</span><br><span class="line">这条语句like右边索引会失效</span><br><span class="line">explain select * from user where name like &#39;%zhangsan&#39; and age &gt; 20 ;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/icbtbo/cloudimg//img/20210702201138.png" alt="索引失效的情况"></p>
<h2 id="尽量使用覆盖索引"><a href="#尽量使用覆盖索引" class="headerlink" title="尽量使用覆盖索引"></a>尽量使用覆盖索引</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">只访问索引查询（索引列和查询列一致），减少select*</span><br><span class="line">explain select name,age,pos,phone from user where age &#x3D; 20;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/icbtbo/cloudimg//img/20210702201147.png" alt="索引失效的情况"></p>
<h2 id="like以通配符开头（’-abc’）"><a href="#like以通配符开头（’-abc’）" class="headerlink" title="like以通配符开头（’%abc’）"></a>like以通配符开头（’%abc’）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">索引失效</span><br><span class="line">explain select * from user where name like &#39;%zhangsan&#39;;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/icbtbo/cloudimg//img/20210702201201.png" alt="索引失效的情况"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">索引生效</span><br><span class="line">explain select * from user where name like &#39;zhangsan%&#39;;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/icbtbo/cloudimg//img/20210702201215.png" alt="索引失效的情况"></p>
<h2 id="字符串不加单引号索引失效"><a href="#字符串不加单引号索引失效" class="headerlink" title="字符串不加单引号索引失效"></a>字符串不加单引号索引失效</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">进行了隐式转换</span><br><span class="line">explain select * from user where name &#x3D; 2000;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/icbtbo/cloudimg//img/20210702201224.png" alt="索引失效的情况"></p>
<h2 id="or连接"><a href="#or连接" class="headerlink" title="or连接"></a>or连接</h2><p><strong>但并不是所有的or都会使索引失效，如果or连接的所有条件字段都设置了索引，那么还是会走索引的；一旦有一个条件没有建立索引，那么就会走全表扫描。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">少用or </span><br><span class="line">explain select * from user where name &#x3D; &#39;2000&#39; or age &#x3D; 20 or pos &#x3D;&#39;cxy&#39;;</span><br></pre></td></tr></table></figure>

<p><img src="https://segmentfault.com/img/remote/1460000021464588" alt="索引失效的情况"></p>
<h2 id="关于IS-NULL、IS-NOT-NULL、"><a href="#关于IS-NULL、IS-NOT-NULL、" class="headerlink" title="关于IS NULL、IS NOT NULL、!="></a>关于IS NULL、IS NOT NULL、!=</h2><p>在WHERE子句中出现<code>IS NULL</code>、<code>IS NOT NULL</code>、<code>!=</code>这些条件仍然可以使用索引，本质上都是优化器去计算一下对应的二级索引数量占所有记录数量的比值，如果这个条数占整个记录条数的比例特别大，那么就趋向于使用全表扫描执行查询，否则趋向于使用这个索引执行查询。</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903921450745863">详细内容可参考这篇博文</a></p>
<h1 id="查询优化"><a href="#查询优化" class="headerlink" title="查询优化"></a>查询优化</h1><h2 id="小表驱动大表"><a href="#小表驱动大表" class="headerlink" title="小表驱动大表"></a>小表驱动大表</h2><blockquote>
<p>优化原则：对于MySQL数据库而言，永远都是小表驱动大表。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">* 举个例子：可以使用嵌套的for循环来理解小表驱动大表。</span><br><span class="line">* 以下两个循环结果都是一样的，但是对于MySQL来说不一样，</span><br><span class="line">* 第一种可以理解为，和MySQL建立5次连接每次查询1000次。</span><br><span class="line">* 第一种可以理解为，和MySQL建立1000次连接每次查询5次。</span><br><span class="line">*&#x2F;</span><br><span class="line">for(int i &#x3D; 1; i &lt;&#x3D; 5; i ++)&#123;</span><br><span class="line">    for(int j &#x3D; 1; j &lt;&#x3D; 1000; j++)&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~</span><br><span class="line">for(int i &#x3D; 1; i &lt;&#x3D; 1000; i ++)&#123;</span><br><span class="line">    for(int j &#x3D; 1; j &lt;&#x3D; 5; j++)&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>IN和EXISTS</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* 优化原则：小表驱动大表，即小的数据集驱动大的数据集 *&#x2F;</span><br><span class="line"></span><br><span class="line">&#x2F;* IN适合B表比A表数据小的情况*&#x2F;</span><br><span class="line">SELECT * FROM &#96;A&#96; WHERE &#96;id&#96; IN (SELECT &#96;id&#96; FROM &#96;B&#96;)</span><br><span class="line"></span><br><span class="line">&#x2F;* EXISTS适合B表比A表数据大的情况 *&#x2F;</span><br><span class="line">SELECT * FROM &#96;A&#96; WHERE EXISTS (SELECT 1 FROM &#96;B&#96; WHERE &#96;B&#96;.id &#x3D; &#96;A&#96;.id);</span><br></pre></td></tr></table></figure>

<p><strong>EXISTS：</strong></p>
<ul>
<li>语法：<code>SELECT....FROM tab WHERE EXISTS(subquery);</code>该语法可以理解为：</li>
<li>该语法可以理解为：将主查询的数据，放到子查询中做条件验证，根据验证结果（<code>true</code>或是<code>false</code>）来决定主查询的数据结果是否得以保留。</li>
</ul>
<p><strong>提示：</strong></p>
<ul>
<li><code>EXISTS(subquery)</code>子查询只返回<code>true</code>或者<code>false</code>，因此子查询中的<code>SELECT *</code>可以是<code>SELECT 1 OR SELECT X</code>，它们并没有区别。</li>
<li><code>EXISTS(subquery)</code>子查询的实际执行过程可能经过了优化而不是我们理解上的逐条对比，如果担心效率问题，可进行实际检验以确定是否有效率问题。</li>
<li><code>EXISTS(subquery)</code>子查询往往也可以用条件表达式，其他子查询或者<code>JOIN</code>替代，何种最优需要具体问题具体分析。</li>
</ul>
<h2 id="group-by"><a href="#group-by" class="headerlink" title="group by"></a>group by</h2><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/b2963c29af0e">group by 执行过程可看此处</a></p>
<p><a target="_blank" rel="noopener" href="https://www.docs4dev.com/docs/zh/mysql/5.7/reference/group-by-optimization.html">使用索引优化需满足的条件可看官方文档</a></p>
<h2 id="order-by优化"><a href="#order-by优化" class="headerlink" title="order by优化"></a>order by优化</h2><h3 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;talA&#96;(</span><br><span class="line">&#96;age&#96; INT,</span><br><span class="line">&#96;birth&#96; TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO &#96;talA&#96;(&#96;age&#96;) VALUES(18);</span><br><span class="line">INSERT INTO &#96;talA&#96;(&#96;age&#96;) VALUES(19);</span><br><span class="line">INSERT INTO &#96;talA&#96;(&#96;age&#96;) VALUES(20);</span><br><span class="line">INSERT INTO &#96;talA&#96;(&#96;age&#96;) VALUES(21);</span><br><span class="line">INSERT INTO &#96;talA&#96;(&#96;age&#96;) VALUES(22);</span><br><span class="line">INSERT INTO &#96;talA&#96;(&#96;age&#96;) VALUES(23);</span><br><span class="line">INSERT INTO &#96;talA&#96;(&#96;age&#96;) VALUES(24);</span><br><span class="line">INSERT INTO &#96;talA&#96;(&#96;age&#96;) VALUES(25);</span><br><span class="line"></span><br><span class="line">&#x2F;* 创建索引 *&#x2F;</span><br><span class="line">CREATE INDEX idx_talA_age_birth ON &#96;talA&#96;(&#96;age&#96;, &#96;birth&#96;);</span><br></pre></td></tr></table></figure>

<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* 1.使用索引进行排序了 不会产生Using filesort *&#x2F;</span><br><span class="line">EXPLAIN SELECT * FROM &#96;talA&#96; WHERE &#96;age&#96; &gt; 20 ORDER BY &#96;age&#96;;</span><br><span class="line"></span><br><span class="line">&#x2F;* 2.使用索引进行排序了 不会产生Using filesort *&#x2F;</span><br><span class="line">EXPLAIN SELECT * FROM &#96;talA&#96; WHERE &#96;age&#96; &gt; 20 ORDER BY &#96;age&#96;,&#96;birth&#96;;</span><br><span class="line"></span><br><span class="line">&#x2F;* 3.没有使用索引进行排序 产生了Using filesort *&#x2F;</span><br><span class="line">EXPLAIN SELECT * FROM &#96;talA&#96; WHERE &#96;age&#96; &gt; 20 ORDER BY &#96;birth&#96;;</span><br><span class="line"></span><br><span class="line">&#x2F;* 4.没有使用索引进行排序 产生了Using filesort *&#x2F;</span><br><span class="line">EXPLAIN SELECT * FROM &#96;talA&#96; WHERE &#96;age&#96; &gt; 20 ORDER BY &#96;birth&#96;,&#96;age&#96;;</span><br><span class="line"></span><br><span class="line">&#x2F;* 5.没有使用索引进行排序 产生了Using filesort *&#x2F;</span><br><span class="line">EXPLAIN SELECT * FROM &#96;talA&#96; ORDER BY &#96;birth&#96;;</span><br><span class="line"></span><br><span class="line">&#x2F;* 6.没有使用索引进行排序 产生了Using filesort *&#x2F;</span><br><span class="line">EXPLAIN SELECT * FROM &#96;talA&#96; WHERE &#96;birth&#96; &gt; &#39;2020-08-04 07:42:21&#39; ORDER BY &#96;birth&#96;;</span><br><span class="line"></span><br><span class="line">&#x2F;* 7.使用索引进行排序了 不会产生Using filesort *&#x2F;</span><br><span class="line">EXPLAIN SELECT * FROM &#96;talA&#96; WHERE &#96;birth&#96; &gt; &#39;2020-08-04 07:42:21&#39; ORDER BY &#96;age&#96;;</span><br><span class="line"></span><br><span class="line">&#x2F;* 8.没有使用索引进行排序 产生了Using filesort *&#x2F;</span><br><span class="line">EXPLAIN SELECT * FROM &#96;talA&#96; ORDER BY &#96;age&#96; ASC, &#96;birth&#96; DESC;</span><br></pre></td></tr></table></figure>

<p><code>ORDER BY</code>子句，尽量使用索引排序，避免使用<code>Using filesort</code>排序。</p>
<p>MySQL支持两种方式的排序，<code>FileSort</code>和<code>Index</code>，<code>Index</code>的效率高，它指MySQL扫描索引本身完成排序。<code>FileSort</code>方式效率较低。</p>
<p><code>ORDER BY</code>满足两情况，会使用<code>Index</code>方式排序：</p>
<ul>
<li><code>ORDER BY</code>语句使用索引最左前列(升降序要一致)。</li>
<li>使用<code>WHERE</code>子句与<code>ORDER BY</code>子句条件列组合满足索引最左前列(升降序要一致)。</li>
</ul>
<p><strong>结论：尽可能在索引列上完成排序操作，遵照索引建的最佳左前缀原则。</strong></p>
<h3 id="File-Sort"><a href="#File-Sort" class="headerlink" title="File Sort"></a>File Sort</h3><p>如果不在索引列上，File Sort有两种算法：MySQL就要启动双路排序算法和单路排序算法</p>
<ul>
<li><p>双路排序算法：MySQL4.1之前使用双路排序，字面意思就是两次扫描磁盘，最终得到数据，读取行指针和<code>ORDER BY</code>列，対他们进行排序，然后扫描已经排序好的列表，按照列表中的值重新从列表中读取对应的数据输出。<strong>一句话，从磁盘取排序字段，在<code>buffer</code>中进行排序，再从磁盘取其他字段。</strong>取一批数据，要对磁盘进行两次扫描，众所周知，IO是很耗时的，所以在MySQL4.1之后，出现了改进的算法，就是单路排序算法。</p>
</li>
<li><p>单路排序算法：从磁盘读取查询需要的所有列，按照<code>ORDER BY</code>列在<code>buffer</code>対它们进行排序，然后扫描排序后的列表进行输出，它的效率更快一些，避免了第二次读取数据。并且把随机IO变成了顺序IO，但是它会使用更多的空间，因为它把每一行都保存在内存中了。</p>
</li>
</ul>
<p>由于单路排序算法是后出的，总体而言效率好过双路排序算法。</p>
<p>但是单路排序算法有问题：如果<code>SortBuffer</code>缓冲区太小，导致从磁盘中读取所有的列不能完全保存在<code>SortBuffer</code>缓冲区中，这时候单路复用算法就会出现问题，反而性能不如双路复用算法。</p>
<p><strong>单路复用算法的优化策略：</strong></p>
<ul>
<li>增大<code>sort_buffer_size</code>参数的设置。</li>
<li>增大<code>max_length_for_sort_data</code>参数的设置。</li>
</ul>
<h3 id="提高ORDER-BY排序速度的方式"><a href="#提高ORDER-BY排序速度的方式" class="headerlink" title="提高ORDER BY排序速度的方式"></a>提高ORDER BY排序速度的方式</h3><ul>
<li><code>ORDER BY</code>时使用<code>SELECT *</code>是大忌，查什么字段就写什么字段，这点非常重要。在这里的影响是：<ul>
<li>当查询的字段大小总和小于<code>max_length_for_sort_data</code>而且排序字段不是<code>TEXT|BLOB</code>类型时，会使用单路排序算法，否则使用多路排序算法。</li>
<li>两种排序算法的数据都有可能超出<code>sort_buffer</code>缓冲区的容量，超出之后，会创建<code>tmp</code>临时文件进行合并排序，导致多次IO，但是单路排序算法的风险会更大一些，所以要增大<code>sort_buffer_size</code>参数的设置。</li>
</ul>
</li>
<li>尝试提高<code>sort_buffer_size</code>：不管使用哪种算法，提高这个参数都会提高效率，当然，要根据系统的能力去提高，因为这个参数是针对每个进程的。</li>
<li>尝试提高<code>max_length_for_sort_data</code>：提高这个参数，会增加用单路排序算法的概率。但是如果设置的太高，数据总容量<code>sort_buffer_size</code>的概率就增大，明显症状是高的磁盘IO活动和低的处理器使用率。</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>MySQL两种排序方式：<code>Using filesort</code>和<code>Index</code>扫描有序索引排序。</li>
<li>MySQL能为排序与查询使用相同的索引，创建的索引既可以用于排序也可以用于查询。</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">icbtbo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://icbtbo.github.io/2021/07/03/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL%E4%B9%8BSQL%E8%AF%AD%E5%8F%A5%E5%88%86%E6%9E%90%E5%8F%8A%E4%BC%98%E5%8C%96/">https://icbtbo.github.io/2021/07/03/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL%E4%B9%8BSQL%E8%AF%AD%E5%8F%A5%E5%88%86%E6%9E%90%E5%8F%8A%E4%BC%98%E5%8C%96/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://icbtbo.github.io" target="_blank">sjc的搬砖小屋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a><a class="post-meta__tags" href="/tags/%E7%B4%A2%E5%BC%95/">索引</a><a class="post-meta__tags" href="/tags/%E4%BC%98%E5%8C%96/">优化</a></div><div class="post_share"><div class="social-share" data-image="/img/default_bg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/07/03/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL%E4%B9%8B%E9%94%81/"><img class="prev-cover" src="/img/default_bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MySQL之锁</div></div></a></div><div class="next-post pull-right"><a href="/2021/06/29/%E3%80%8A%E9%AB%98%E6%80%A7%E8%83%BDMySQL%E3%80%8B%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/%E9%AB%98%E6%80%A7%E8%83%BDMySQL%E4%B9%8B%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/"><img class="next-cover" src="/img/default_bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">高性能MySQL之高级特性</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/07/03/数据库/MySQL之主从复制/" title="MySQL之主从复制"><img class="cover" src="/img/default_bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-03</div><div class="title">MySQL之主从复制</div></div></a></div><div><a href="/2021/07/03/数据库/MySQL之锁/" title="MySQL之锁"><img class="cover" src="/img/default_bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-03</div><div class="title">MySQL之锁</div></div></a></div><div><a href="/2021/06/29/《高性能MySQL》阅读笔记/高性能MySQL之索引/" title="高性能MySQL之索引"><img class="cover" src="/img/default_bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-29</div><div class="title">高性能MySQL之索引</div></div></a></div><div><a href="/2021/06/29/《高性能MySQL》阅读笔记/高性能MySQL之高级特性/" title="高性能MySQL之高级特性"><img class="cover" src="/img/default_bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-29</div><div class="title">高性能MySQL之高级特性</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/niu.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">icbtbo</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">103</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">83</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/icbtbo"><i class="fab fa-github"></i><span>Github</span></a></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#expain%E5%91%BD%E4%BB%A4%E8%A7%A3%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">expain命令解析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#explain%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.1.</span> <span class="toc-text">explain示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#explain%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.2.</span> <span class="toc-text">explain参数详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#id"><span class="toc-number">1.2.1.</span> <span class="toc-text">id</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select-type"><span class="toc-number">1.2.2.</span> <span class="toc-text">select_type</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#table"><span class="toc-number">1.2.3.</span> <span class="toc-text">table</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#partitions"><span class="toc-number">1.2.4.</span> <span class="toc-text">partitions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#type"><span class="toc-number">1.2.5.</span> <span class="toc-text">type</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#possible-keys"><span class="toc-number">1.2.6.</span> <span class="toc-text">possible_keys</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#key"><span class="toc-number">1.2.7.</span> <span class="toc-text">key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#key-len"><span class="toc-number">1.2.8.</span> <span class="toc-text">key_len</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ref"><span class="toc-number">1.2.9.</span> <span class="toc-text">ref</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rows"><span class="toc-number">1.2.10.</span> <span class="toc-text">rows</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#filterrd"><span class="toc-number">1.2.11.</span> <span class="toc-text">filterrd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Extra"><span class="toc-number">1.2.12.</span> <span class="toc-text">Extra</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-number">2.</span> <span class="toc-text">慢查询日志</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.1.</span> <span class="toc-text">基本介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7"><span class="toc-number">2.2.</span> <span class="toc-text">日志分析工具</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Show-Profile"><span class="toc-number">3.</span> <span class="toc-text">Show Profile</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%A0%E9%99%A4"><span class="toc-number">4.</span> <span class="toc-text">索引的创建和删除</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88"><span class="toc-number">5.</span> <span class="toc-text">索引失效</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E6%95%B0%E6%8D%AE"><span class="toc-number">5.1.</span> <span class="toc-text">示例数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9D%E5%8F%8D%E6%9C%80%E5%B7%A6%E5%89%8D%E7%BC%80%E6%B3%95%E5%88%99"><span class="toc-number">5.2.</span> <span class="toc-text">违反最左前缀法则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8%E7%B4%A2%E5%BC%95%E5%88%97%E4%B8%8A%E5%81%9A%E4%BB%BB%E4%BD%95%E6%93%8D%E4%BD%9C"><span class="toc-number">5.3.</span> <span class="toc-text">在索引列上做任何操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E8%8C%83%E5%9B%B4%E6%9D%A1%E4%BB%B6%E5%8F%B3%E8%BE%B9%E7%9A%84%E5%88%97"><span class="toc-number">5.4.</span> <span class="toc-text">索引范围条件右边的列</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%BD%E9%87%8F%E4%BD%BF%E7%94%A8%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95"><span class="toc-number">5.5.</span> <span class="toc-text">尽量使用覆盖索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#like%E4%BB%A5%E9%80%9A%E9%85%8D%E7%AC%A6%E5%BC%80%E5%A4%B4%EF%BC%88%E2%80%99-abc%E2%80%99%EF%BC%89"><span class="toc-number">5.6.</span> <span class="toc-text">like以通配符开头（’%abc’）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8D%E5%8A%A0%E5%8D%95%E5%BC%95%E5%8F%B7%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88"><span class="toc-number">5.7.</span> <span class="toc-text">字符串不加单引号索引失效</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#or%E8%BF%9E%E6%8E%A5"><span class="toc-number">5.8.</span> <span class="toc-text">or连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8EIS-NULL%E3%80%81IS-NOT-NULL%E3%80%81"><span class="toc-number">5.9.</span> <span class="toc-text">关于IS NULL、IS NOT NULL、!&#x3D;</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="toc-number">6.</span> <span class="toc-text">查询优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E8%A1%A8%E9%A9%B1%E5%8A%A8%E5%A4%A7%E8%A1%A8"><span class="toc-number">6.1.</span> <span class="toc-text">小表驱动大表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#group-by"><span class="toc-number">6.2.</span> <span class="toc-text">group by</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#order-by%E4%BC%98%E5%8C%96"><span class="toc-number">6.3.</span> <span class="toc-text">order by优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87"><span class="toc-number">6.3.1.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">6.3.2.</span> <span class="toc-text">案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#File-Sort"><span class="toc-number">6.3.3.</span> <span class="toc-text">File Sort</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E9%AB%98ORDER-BY%E6%8E%92%E5%BA%8F%E9%80%9F%E5%BA%A6%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">6.3.4.</span> <span class="toc-text">提高ORDER BY排序速度的方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">6.3.5.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/01/05/Redis/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E7%8B%AC%E7%AB%8B%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AE%9E%E7%8E%B0/" title="Redis设计与实现:独立功能的实现"><img src="/img/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redis设计与实现:独立功能的实现"/></a><div class="content"><a class="title" href="/2022/01/05/Redis/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E7%8B%AC%E7%AB%8B%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AE%9E%E7%8E%B0/" title="Redis设计与实现:独立功能的实现">Redis设计与实现:独立功能的实现</a><time datetime="2022-01-05T12:59:07.000Z" title="发表于 2022-01-05 20:59:07">2022-01-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/01/05/Redis/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E5%A4%9A%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%AE%9E%E7%8E%B0/" title="Redis设计与实现:多机数据库的实现"><img src="/img/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redis设计与实现:多机数据库的实现"/></a><div class="content"><a class="title" href="/2022/01/05/Redis/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E5%A4%9A%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%AE%9E%E7%8E%B0/" title="Redis设计与实现:多机数据库的实现">Redis设计与实现:多机数据库的实现</a><time datetime="2022-01-05T01:35:35.000Z" title="发表于 2022-01-05 09:35:35">2022-01-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/01/04/Redis/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%AE%9E%E7%8E%B0/" title="Redis设计与实现:单机数据库的实现"><img src="/img/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redis设计与实现:单机数据库的实现"/></a><div class="content"><a class="title" href="/2022/01/04/Redis/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E5%8D%95%E6%9C%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%AE%9E%E7%8E%B0/" title="Redis设计与实现:单机数据库的实现">Redis设计与实现:单机数据库的实现</a><time datetime="2022-01-04T06:38:05.000Z" title="发表于 2022-01-04 14:38:05">2022-01-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/12/18/Redis/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/" title="Redis设计与实现:数据结构与对象"><img src="/img/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redis设计与实现:数据结构与对象"/></a><div class="content"><a class="title" href="/2021/12/18/Redis/Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E8%B1%A1/" title="Redis设计与实现:数据结构与对象">Redis设计与实现:数据结构与对象</a><time datetime="2021-12-18T09:16:04.000Z" title="发表于 2021-12-18 17:16:04">2021-12-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/11/25/kafka/kafka%E8%BF%9B%E9%98%B6%E7%AF%87%EF%BC%9A%E5%8F%AF%E9%9D%A0%E6%80%A7%E6%8E%A2%E7%A9%B6%E3%80%81%E5%BA%94%E7%94%A8%E3%80%81%E7%9B%91%E6%8E%A7%E5%92%8C%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8/" title="kafka进阶篇：可靠性探究、应用、监控和高级应用"><img src="/img/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="kafka进阶篇：可靠性探究、应用、监控和高级应用"/></a><div class="content"><a class="title" href="/2021/11/25/kafka/kafka%E8%BF%9B%E9%98%B6%E7%AF%87%EF%BC%9A%E5%8F%AF%E9%9D%A0%E6%80%A7%E6%8E%A2%E7%A9%B6%E3%80%81%E5%BA%94%E7%94%A8%E3%80%81%E7%9B%91%E6%8E%A7%E5%92%8C%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8/" title="kafka进阶篇：可靠性探究、应用、监控和高级应用">kafka进阶篇：可靠性探究、应用、监控和高级应用</a><time datetime="2021-11-25T01:59:17.000Z" title="发表于 2021-11-25 09:59:17">2021-11-25</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By icbtbo</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> {preloader.endLoading()})</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    let initData = {
      el: '#vcomment',
      appId: 'pLWJLVgdxc6WLcEaFgEr2tQ2-gzGzoHsz',
      appKey: 'OAmeyAUV6TdXoX5n1hSX4ELm',
      placeholder: '请留下你的小脚印～',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      master: 'f94877d77182a6f9068fc12b5545e1f5',
      tagMeta: ["博主","小伙伴","访客"],
      friends: ["52dc4d80afb3aeab1d0deab1aa45a7b5","fd99ca470e7b5e8e2b4f76d6ed26d6cf"]
    }

    if (true) { 
      initData.requiredFields= ('nick,mail'.split(','))
    }
    
    if (false) {
      const otherData = false
      initData = Object.assign({}, initData, otherData)
    }
    
    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else $.getScript('https://cdn.jsdelivr.net/gh/HCLonely/Valine@latest/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script></div></body></html>